package org.example.service.impl;

import com.alibaba.fastjson.JSONObject;
import org.example.service.IOcrService;
import org.junit.jupiter.api.Test;
import org.junit.runner.RunWith;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.test.context.junit4.SpringRunner;

import java.text.ParseException;

import static org.junit.jupiter.api.Assertions.*;

/**
 * @author Ethan
 * @version 1.0
 * @date 9/2 11:42
 */
@SpringBootTest
@RunWith(SpringRunner.class)
class OcrServiceImplTest {

    @Autowired
    IOcrService ocrService;

    @Test
    void checkTicket() throws ParseException {
        String img = "{\"data\":{\"ret\":[{\"ret\":[{\"word_name\":\"date\",\"word\":\"2019年10月02日\"},{\"word_name\":\"starting_station\",\"word\":\"六安站\"},{\"word_name\":\"ticket_num\",\"word\":\"Z5Q008000\"},{\"word_name\":\"train_num\",\"word\":\"D2193\"},{\"word_name\":\"ticket_rates\",\"word\":\"￥101.0元\"},{\"word_name\":\"serial_number\",\"word\":\"4118730005103Q0080\"},{\"word_name\":\"seat_category\",\"word\":\"二等座\"},{\"word_name\":\"name\",\"word\":\"孙当佳\"},{\"word_name\":\"id_num\",\"word\":\"4104211994****4512\"},{\"word_name\":\"destination_station\",\"word\":\"汉口站\"},{\"word_name\":\"time\",\"word\":\"19:34\"},{\"word_name\":\"sales_station\",\"word\":\"六雯\"},{\"word_name\":\"seat_num\",\"word\":\"10车14A号\"}],\"receiptCoordinate\":\"{\\\"height\\\":158,\\\"left\\\":426,\\\"top\\\":83,\\\"width\\\":255}\",\"error_msg\":\"\",\"templateSign\":\"train_ticket\",\"templateName\":\"火车票\",\"scores\":1.0,\"isStructured\":true,\"error_code\":0},{\"ret\":[{\"word_name\":\"date\",\"word\":\"2016年03月25日\"},{\"word_name\":\"starting_station\",\"word\":\"北京西站\"},{\"word_name\":\"ticket_num\",\"word\":\"B038664\"},{\"word_name\":\"train_num\",\"word\":\"G623\"},{\"word_name\":\"ticket_rates\",\"word\":\"￥375元\"},{\"word_name\":\"serial_number\",\"word\":\"211523017025B038664\"},{\"word_name\":\"seat_category\",\"word\":\"二等座\"},{\"word_name\":\"name\",\"word\":\"常朋网\"},{\"word_name\":\"id_num\",\"word\":\"1304281986****0114\"},{\"word_name\":\"destination_station\",\"word\":\"高碑店东站\"},{\"word_name\":\"time\",\"word\":\"18:07\"},{\"word_name\":\"sales_station\",\"word\":\"北京西\"},{\"word_name\":\"seat_num\",\"word\":\"10车14D号\"}],\"receiptCoordinate\":\"{\\\"height\\\":159,\\\"left\\\":142,\\\"top\\\":263,\\\"width\\\":254}\",\"error_msg\":\"\",\"templateSign\":\"train_ticket\",\"templateName\":\"火车票\",\"scores\":1.0,\"isStructured\":true,\"error_code\":0},{\"ret\":[{\"word_name\":\"date\",\"word\":\"2019年03月01日\"},{\"word_name\":\"starting_station\",\"word\":\"兖州站\"},{\"word_name\":\"ticket_num\",\"word\":\"W076087\"},{\"word_name\":\"train_num\",\"word\":\"1227\"},{\"word_name\":\"ticket_rates\",\"word\":\"￥105元\"},{\"word_name\":\"serial_number\",\"word\":\"1001310540301W076087\"},{\"word_name\":\"seat_category\",\"word\":\"新空调硬座\"},{\"word_name\":\"name\",\"word\":\"陈涛站\"},{\"word_name\":\"id_num\",\"word\":\"3704811989****1698\"},{\"word_name\":\"destination_station\",\"word\":\"滕州站\"},{\"word_name\":\"time\",\"word\":\"07:56\"},{\"word_name\":\"sales_station\",\"word\":\"北京\"},{\"word_name\":\"seat_num\",\"word\":\"03车010号\"}],\"receiptCoordinate\":\"{\\\"height\\\":158,\\\"left\\\":143,\\\"top\\\":83,\\\"width\\\":256}\",\"error_msg\":\"\",\"templateSign\":\"train_ticket\",\"templateName\":\"火车票\",\"scores\":1.0,\"isStructured\":true,\"error_code\":0},{\"ret\":[{\"word_name\":\"date\",\"word\":\"2015年02月14日\"},{\"word_name\":\"starting_station\",\"word\":\"北京西站\"},{\"word_name\":\"ticket_num\",\"word\":\"U088546\"},{\"word_name\":\"train_num\",\"word\":\"G669\"},{\"word_name\":\"ticket_rates\",\"word\":\"￥209.00元\"},{\"word_name\":\"serial_number\",\"word\":\"211522118002140008516\"},{\"word_name\":\"seat_category\",\"word\":\"始发改签\"},{\"word_name\":\"name\",\"word\":\"常朋次\"},{\"word_name\":\"id_num\",\"word\":\"1304281986****0114\"},{\"word_name\":\"destination_station\",\"word\":\"邯郸东站\"},{\"word_name\":\"time\",\"word\":\"11:37\"},{\"word_name\":\"sales_station\",\"word\":\"京\"},{\"word_name\":\"seat_num\",\"word\":\"340车08C号\"}],\"receiptCoordinate\":\"{\\\"height\\\":175,\\\"left\\\":427,\\\"top\\\":262,\\\"width\\\":260}\",\"error_msg\":\"\",\"templateSign\":\"train_ticket\",\"templateName\":\"火车票\",\"scores\":1.0,\"isStructured\":true,\"error_code\":0}],\"logId\":\"159901795991439\"},\"error_code\":0,\"error_msg\":\"\",\"log_id\":\"159901795991439\"}\n";
        String table = "{\"data\":{\"ret\":[{\"probability\":{\"average\":0.995978,\"min\":0.976627,\"variance\":0.000053},\"location\":{\"top\":190,\"left\":242,\"width\":58,\"height\":12},\"word_name\":\"返回日期\",\"word\":\"2019-08-25\"},{\"probability\":{\"average\":0.999753,\"min\":0.999568,\"variance\":0.0},\"location\":{\"top\":246,\"left\":260,\"width\":20,\"height\":13},\"word_name\":\"交通工具\",\"word\":\"火车\"},{\"probability\":{\"average\":0.999836,\"min\":0.999687,\"variance\":0.0},\"location\":{\"top\":227,\"left\":261,\"width\":19,\"height\":13},\"word_name\":\"出差地点\",\"word\":\"上海\"},{\"probability\":{\"average\":0.999121,\"min\":0.999121,\"variance\":0.0},\"location\":{\"top\":209,\"left\":267,\"width\":6,\"height\":12},\"word_name\":\"出差天数\",\"word\":\"8\"},{\"probability\":{\"average\":0.99864,\"min\":0.996615,\"variance\":0.000001},\"location\":{\"top\":265,\"left\":250,\"width\":41,\"height\":13},\"word_name\":\"预算总金额\",\"word\":\"3850.00\"},{\"probability\":{\"average\":0.998507,\"min\":0.996117,\"variance\":0.000002},\"location\":{\"top\":320,\"left\":259,\"width\":27,\"height\":14},\"word_name\":\"城际交通费\",\"word\":\"0.00\"},{\"probability\":{\"average\":0.986603,\"min\":0.874678,\"variance\":0.001126},\"location\":{\"top\":95,\"left\":230,\"width\":81,\"height\":11},\"word_name\":\"商旅申请单号\",\"word\":\"SS201908151843\"},{\"probability\":{\"average\":0.993161,\"min\":0.939111,\"variance\":0.000326},\"location\":{\"top\":169,\"left\":241,\"width\":61,\"height\":14},\"word_name\":\"出发日期\",\"word\":\"2019-08-18\"},{\"probability\":{\"average\":0.978458,\"min\":0.883536,\"variance\":0.001812},\"location\":{\"top\":113,\"left\":237,\"width\":67,\"height\":13},\"word_name\":\"出行人\",\"word\":\"陆凌姣、陈晶\"},{\"probability\":{\"average\":0.998773,\"min\":0.996278,\"variance\":0.000001},\"location\":{\"top\":303,\"left\":250,\"width\":43,\"height\":13},\"word_name\":\"住宿费\",\"word\":\"3850.00\"},{\"probability\":{\"average\":0.99945,\"min\":0.998834,\"variance\":0.0},\"location\":{\"top\":341,\"left\":258,\"width\":27,\"height\":13},\"word_name\":\"其他费用\",\"word\":\"0.00\"},{\"probability\":{\"average\":0.998112,\"min\":0.988266,\"variance\":0.00001},\"location\":{\"top\":150,\"left\":171,\"width\":197,\"height\":15},\"word_name\":\"出差事由详情\",\"word\":\"苏州新人(普惠金融/大数据)上海代培\"}],\"templateSign\":\"f51e2842959e0b21de6a6465c8c2f2c2\",\"templateName\":\"demo\",\"scores\":1.0,\"isStructured\":true,\"logId\":\"159901772697071\",\"templateMatchDegree\":0.9821474898231636,\"clockwiseAngle\":360.0},\"error_code\":0,\"error_msg\":\"\",\"log_id\":\"159901772697071\"}\n";
        JSONObject imgJson = JSONObject.parseObject(img);
        JSONObject tableJson = JSONObject.parseObject(table);
        String ticket = ocrService.checkTicket(tableJson, imgJson);
    }
}